SELECT DISTINCT TOP (50)
	'ID_400007_CashPaymentCA_BETA_Person_BGN' AS [TEST_ID]
	,	[DEAL].[DEAL_TYPE]
	,	[DEAL].[DEAL_NUM]
	,	[CUST].[CUSTOMER_ID]
	,	[PROXY].[CUSTOMER_ID] AS [REPRESENTATIVE_CUSTOMER_ID]
FROM dbo.[AGR_CASH_PAYMENTS_DEALS] [DEAL] WITH (NOLOCK)
INNER JOIN dbo.[AGR_CASH_PAYMENTS_CUSTOMERS] [CUST] WITH (NOLOCK)
	ON	[CUST].[CUSTOMER_ID] = [DEAL].[CUSTOMER_ID]
	AND [DEAL].[CLIENT_SECTOR] = 5000
	AND [DEAL].[DEAL_CURRENCY_CODE] = 100
INNER JOIN dbo.[AGR_CASH_PAYMENTS_CUSTOMERS] [PROXY] WITH (NOLOCK)
	ON	[PROXY].[CUSTOMER_ID] = [DEAL].[CUSTOMER_ID]
WHERE [CUST].[CLIENT_TYPE_DT300_CODE]	 = 4
	AND [PROXY].[CLIENT_BIRTH_DATE] BETWEEN 18320511 AND 20040511
	AND [CUST].[HAS_MANY_CLIENT_CODES]	 = 0
	AND [CUST].[HAS_DUBL_CLIENT_IDS]	 = 0
	AND [CUST].[CUSTOMER_CHARACTERISTIC] = 0
	AND [PROXY].[HAS_VALID_DOCUMENT]	 = 1
	AND [CUST].[HAS_LOAN]				 = 0
	AND [DEAL].[DEAL_IS_INDIVIDUAL_DEAL] = 1
	AND [DEAL].[DEAL_IS_JOINT_DEAL] 	 = 0
	AND [DEAL].[IS_DORMUNT_ACCOUNT] 	 = 0
	AND [DEAL].[HAS_TAX_UNCOLECTED] 	 = 0
	AND NOT EXISTS (
		SELECT *
		FROM dbo.[AGR_CASH_PAYMENTS_DEALS_WITH_OTHER_TAX_ACCOUNT] [TAX] WITH (NOLOCK)
		WHERE [TAX].[CORR_ACCOUNT] = [DEAL].[DEAL_ACCOUNT]
	)
	AND NOT EXISTS (
		SELECT *
		FROM dbo.[RAZPREG_TA] [TA] WITH (NOLOCK)
		WHERE [TA].[UI_DEAL_NUM] = [DEAL].[DEAL_NUM]
			AND [TA].[TA_TYPE] = 'CashPaymentCA_BETA_Person_BGN'
	)
GO	
